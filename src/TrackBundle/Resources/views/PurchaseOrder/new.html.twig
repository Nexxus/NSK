{% extends "::base.html.twig" %}

{% block body %}
    
    <h1 style="margin-bottom: 30px">{% trans %}Create a Purchase Order{% endtrans %}</h1>

        <form method="POST" name="PurchaseOrder">

            <div class="row">
                <div class="col-md-6">

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-play" aria-hidden="true"></span> {% trans %}Order number{% endtrans %}
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-3">{% trans %}Order number{% endtrans %}</div>
                                <div class="col-sm-6">
                                    <input class="form-control" type="text" name="porder[orderNr]" id="porder-orderNr" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-play" aria-hidden="true"></span> {% trans %}Supplier{% endtrans %}
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-4">{% trans %}New or Existing{% endtrans %}</div>
                                <div class="col-sm-8">
                                    <select class="form-control" name="porder[contact][new]" id="contact-newexisting" onChange="toggleContactForm()" required>
                                        <option name="new" value="new">
                                            {% trans %}New supplier{% endtrans %}
                                        </option>
                                        {% for p in suppliers %}
                                        <option name="{{ p.name }}" value="{{ p.id }}">
                                            {{ p.name }}
                                        </option>
                                        {% endfor %}
                                    </select>

                                </div>
                            </div>

                            <div id="contact-info-new">
                                <div class="form-group row col-sm-12">
                                <hr>
                                    <h4>New supplier:</h4>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-12">
                                        <b>{% trans %}Company name{% endtrans %}</b>
                                        <input class="form-control" type="text" name="porder[contact][companyname]" id="contact-company">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-6">
                                        <b>{% trans %}Representative firstname{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-PersonFName" name="porder[contact][PersonFName]">
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <b>{% trans %}Representative lastname{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-PersonLName" name="porder[contact][PersonLName]">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-6">
                                        <b>{% trans %}Phone Number{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-phone" name="porder[contact][phone]">
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <b>{% trans %}E-mail{% endtrans %}</b>
                                        <input class="form-control" type="email" id="contact-email" name="porder[contact][email]">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-12">
                                        <b>{% trans %}Address{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-address" name="porder[contact][address]">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-4">
                                        <b>{% trans %}Zipcode{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-zipcode" name="porder[contact][zipcode]">
                                    </div>
                                    <div class="form-group col-sm-8">
                                        <b>{% trans %}City{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-city" name="porder[contact][city]">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group col-sm-4">
                                        <b>{% trans %}Province{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-Province" name="porder[contact][province]">
                                    </div>
                                    <div class="form-group col-sm-8">
                                        <b>{% trans %}Country{% endtrans %}</b>
                                        <input class="form-control" type="text" id="contact-country" name="porder[contact][country]">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

                <div class="col-md-6">

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-play" aria-hidden="true"></span> {% trans %}Order status{% endtrans %}
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-3">{% trans %}Picked up?{% endtrans %}</div>
                                <div class="col-sm-3">
                                    <label class="radio-inline">
                                        <input class="form-check-input" type="radio" name="porder[contact][pickedup]" value="Yes" />
                                        {% trans %}Yes{% endtrans %}
                                    </label>
                                    <label class="radio-inline">
                                        <input class="form-check-input" type="radio" name="porder[contact][pickedup]" value="No" checked>
                                        {% trans %}No{% endtrans %}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                                <span class="glyphicon glyphicon-play" aria-hidden="true"></span> {% trans %}Product list{% endtrans %}
                        </div>
                        <div class="panel-body">
                            {% set k = 10 %}
                            {% for i in 1..k %}
                            <div class="productList-item">
                            <div class="form-group row">
                                <div class="col-sm-1" style="white-space: nowrap">
                                    <b>{{ i }}</b> <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
                                </div>
                                <div class="form-group col-sm-3">
                                    <label for="product-type">
                                        {% trans %}Type{% endtrans %}
                                    </label>
                                    <select class="form-control" id="product-type" name="porder[product][{{ i }}][type]">
                                        {% for type in types %}
                                            <option value="{{ type.id }}">
                                                {{ type.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group col-sm-2">
                                    <label for="product-quantity">
                                        {% trans %}Quantity{% endtrans %}
                                    </label>
                                    <input class="form-control" type="text" id="product-{{ i }}-quantity" name="porder[product][{{ i }}][quantity]">
                                </div>
                                {#<div class="form-group col-sm-3">
                                    <label for="product-comments">
                                        {% trans %}Name{% endtrans %}
                                    </label>
                                    <input class="form-control" type="text" id="product-name[{{ i }}]" name="porder[product][{{ i }}][name]">
                                </div>#}
                                <div class="form-group col-sm-6">
                                    <label for="product-comments">
                                        {% trans %}Comments{% endtrans %}
                                    </label>
                                    <input class="form-control" type="text" id="product-comments[{{ i }}]" name="porder[product][{{ i }}][comments]">
                                </div>
                            </div>
                            </div>
                            {% endfor %}
                            <hr />
                            <a class="btn btn-danger btn-sm pull-right" onClick="removeProduct()">- Remove</a>
                            <a class="btn btn-success btn-sm pull-right" onClick="addProduct()" style="margin-right: 5px">+ Add Product</a>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div class="panel panel-default">
               <div class="panel-body text-center">
                   <button class="btn btn-success" style="width: 200px">Create Order</button>
               </div>
            </div>
            
         </form>
 {% endblock %}
 
 {% block javascripts %}
     <script>
         var types = {{ types|json_encode|raw }};

         var prodArr = [1];
 
         $(document).ready(function () {
             var products = document.getElementsByClassName("productList-item");

             renderProductList();
             toggleContactForm();

         }); 
 
         function renderProductList() {
            $('.productList-item').each(function(i, obj) {
                $(obj).hide();
                $(obj).find('input').prop("disabled", true);
                $(obj).find('select').prop("disabled", true);
                if(i in prodArr) {
                    $(obj).show();
                    $(obj).find('input').prop("disabled", false);
                    $(obj).find('select').prop("disabled", false);
                    console.log(prodArr);
                }
             });
         }
            
         function addProduct() {
             prodArr.push(1);
             renderProductList();
         }

         function removeProduct() {
             prodArr.pop(1);
             renderProductList();
         }

         function toggleContactForm() {
            switch($("#contact-newexisting").val()) {
                case 'choose':
                case 'new':
                    console.log($("#contact-newexisting").val());
                    $("#contact-info-new").prop("disabled", false);
                    $("#contact-info-new").prop("disabled", false);
                    $("#contact-info-new").show();
                    break;
                default:
                    console.log($("#contact-newexisting").val());
                    $("#contact-info-new").prop("disabled", true);
                    $("#contact-info-new").prop("disabled", true);
                    $("#contact-info-new").hide();
            }
         }
     </script>
 {% endblock %}
